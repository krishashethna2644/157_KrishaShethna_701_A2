<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Leave History</title>
  <link rel="stylesheet" href="/styles.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <nav class="navbar">
    <h1>Employee Portal</h1>
    <div class="nav-links">
      <a href="/employees/profile">Profile</a>
      <a href="/leaves/apply">Apply Leave</a>
      <a href="/leaves/list" class="active">Leave History</a>
      <a href="/logout">Logout</a>
    </div>
  </nav>

  <div class="container">
    <h2>Leave History</h2>
    <div id="leavesList" class="leaves-container">
      <p>Loading your leave applications...</p>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      loadLeaves();

      async function loadLeaves() {
        try {
          const response = await fetch('/leaves/api/my-leaves');
          const leaves = await response.json();
          
          if (leaves.length === 0) {
            $('#leavesList').html('<p>No leave applications found.</p>');
            return;
          }

          const leavesHtml = leaves.map(leave => `
            <div class="leave-card ${leave.status}">
              <h3>Leave Application</h3>
              <p><strong>Date:</strong> ${new Date(leave.date).toLocaleDateString()}</p>
              <p><strong>Reason:</strong> ${leave.reason}</p>
              <p><strong>Status:</strong> 
                <span class="status ${leave.status}">${leave.status.toUpperCase()}</span>
              </p>
              <p><strong>Applied on:</strong> ${new Date(leave.createdAt).toLocaleString()}</p>
              ${leave.granted ? '<p><strong>Granted:</strong> Yes</p>' : ''}
            </div>
          `).join('');

          $('#leavesList').html(leavesHtml);
        } catch (error) {
          $('#leavesList').html('<p>Error loading leave applications.</p>');
        }
      }
    });
  </script>
</body>
</html>
