<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .nav { background: #ddd; padding: 10px; margin-bottom: 20px; }
    .nav a { color: black; text-decoration: none; margin-right: 15px; }
    .form-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border: 1px solid #ccc; }
    input, select, button { padding: 8px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #e0e0e0; }
  </style>
</head>
<body>
  <div class="nav">
    <a href="/">Home</a>
    <a href="/admin">Admin</a>
  </div>

  <h1>Admin Panel</h1>

  <div class="form-section">
    <h2>Add Category</h2>
    <form method="POST" action="/admin/category">
      <input type="text" name="name" placeholder="Category Name" required>
      <select name="parent">
        <option value="">-- Main Category --</option>
        <% categories.filter(cat => !cat.parent).forEach(cat => { %>
          <option value="<%= cat._id %>"><%= cat.name %></option>
        <% }) %>
      </select>
      <button type="submit">Add Category</button>
    </form>
  </div>

  <div class="form-section">
    <h2>Add Product</h2>
    <form method="POST" action="/admin/product">
      <input type="text" name="name" placeholder="Product Name" required>
      <input type="number" name="price" placeholder="Price" step="0.01" required>
      <input type="number" name="stock" placeholder="Stock Quantity" required>
      <select name="category" required>
        <option value="">-- Select Category --</option>
        <% categories.filter(cat => !cat.parent).forEach(mainCat => { %>
          <optgroup label="<%= mainCat.name %>">
            <option value="<%= mainCat._id %>"><%= mainCat.name %></option>
            <% categories.filter(sub => sub.parent && sub.parent._id.toString() === mainCat._id.toString()).forEach(subCat => { %>
              <option value="<%= subCat._id %>">-- <%= subCat.name %></option>
            <% }) %>
          </optgroup>
        <% }) %>
      </select>
      <button type="submit">Add Product</button>
    </form>
  </div>

  <h2>Categories</h2>
  <table>
    <tr><th>Name</th><th>Parent</th></tr>
    <% categories.forEach(cat => { %>
      <tr>
        <td><%= cat.name %></td>
        <td><%= cat.parent?.name || 'Main Category' %></td>
      </tr>
    <% }) %>
  </table>

  <h2>Products</h2>
  <table>
    <tr><th>Name</th><th>Price</th><th>Category</th><th>Stock</th></tr>
    <% products.forEach(product => { %>
      <tr>
        <td><%= product.name %></td>
        <td>â‚¹<%= product.price %></td>
        <td><%= product.category?.name || 'None' %></td>
        <td><%= product.stock %></td>
      </tr>
    <% }) %>
  </table>
</body>
</html>